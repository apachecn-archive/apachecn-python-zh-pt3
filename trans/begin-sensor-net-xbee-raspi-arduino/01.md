# 1.传感器网络简介

传感器网络不再是昂贵的工业建筑。您可以从容易获得的低成本硬件构建简单的传感器网络。你所需要的只是一些简单的传感器和一个微控制器或具有输入/输出能力的计算机。是的，您的 Arduino 和 Raspberry Pi 是构建传感器网络的理想平台。如果您使用过这两个平台中的任何一个，并且曾经想要监控您的花园池塘、跟踪您家里或办公室的活动、监控您家里的温度、监控环境，或者甚至构建一个低成本的安全系统，那么您已经成功了一半！

虽然听起来很诱人也很简单，但不要马上开始加热烙铁。关于传感器网络，你需要了解很多东西。这并不像把东西插在一起然后打开它们那么简单。如果你想建立一个可靠和信息丰富的传感器网络，你需要知道这样的网络是如何构建的。

另外，你可能听说过一个叫物联网(IoT)的东西。这个短语指的是可以通过网络(本地或互联网)进行通信的设备的使用。因此，物联网设备是网络感知设备，可以向其他资源发送数据，从而虚拟化设备对用户及其体验的影响。传感器网络在物联网中扮演着重要角色。您将在本书中学到的知识将为使用传感器网络构建物联网解决方案奠定坚实的基础。

如果您想从总体上了解更多关于物联网的知识，已经有几本书以此为主题，包括以下内容。如果您有兴趣了解更多有关物联网和传感器网络使用方式的信息，请查看以下书籍:

*   charalappos Doukas(CreateSpace 独立出版平台，2012 年)用 Arduino 构建物联网

*   由 Dieter Uckelmann、Mark Harrison 和 Florian Michahelles (Springer，2011 年)共同构建物联网

*   *物联网入门:将传感器和微控制器连接到云*作者:库诺·菲斯特(2011 年，奥赖利)

在本章中，我们将通过简要描述什么是传感器网络以及它们是如何构建的来探索传感器网络。我们还将研究构成传感器网络的组件，包括传感器概述、可用的传感器类型以及它们可以感知的事物。

## 传感器网络的剖析

传感器网络无处不在。它们通常被认为是制造和医疗应用的复杂监控系统。然而，它们并不总是复杂的，它们就在你的周围。

在本节中，我们将研究传感器网络的构建模块以及它们是如何连接的(逻辑上)。首先，让我们来看一些传感器网络的例子，以便直观地了解这些组件。

### 传感器网络的例子

虽然您可能不太熟悉其中的一些示例，但是在阅读这些示例时，尝试想象一下应用程序的组件是个不错的主意。可视化传感器本身——它们被放置在哪里，它们可能正在读取哪些数据，并将这些数据发送到网络的另一部分进行处理和记录。

#### 汽车的

几乎每辆现代汽车都有一个复杂的传感器网络，用来监控发动机及其子系统的性能。一些汽车有额外的传感器，用于监控外部气温、轮胎压力，甚至物体和其他车辆的接近度。新型汽车有一系列安全机制，包括车道偏离、避障、自动刹车等等。 <sup>[1](#Fn1)</sup>

如果你把一辆新型汽车送去维修，并有机会在车库里看看，你可能会注意到几台类似电脑终端、平板电脑或在某些情况下类似 iPad 的机器。这些系统是诊断机器，旨在连接到您的汽车，并读取传感器和计算机存储的所有数据。一些制造商使用称为车载诊断(OBD)的行业标准接口。 <sup>[2](#Fn2)</sup> 这个接口及其协议有多个版本；大多数经销商都有支持所有最新协议的设备。

然而，一些制造商使用他们自己的专有诊断系统，但许多制造商使用与 OBD-II 相同的连接器。你可能想在买车前问一下这个问题。如果您的新车需要专有的电子工具进行维护，您可能需要将它送到合格的机械师或其他经销商处进行维修。对于那些生活在农村地区的人来说，找到一家经销商甚至是一名训练有素的机械师来修理你的车可能需要一些旅行，因此需要提前计划。

例如，保时捷使用了它所谓的保时捷综合车间信息系统(PIWIS)。虽然 PIWIS 使用与 OBD-II 相同的连接器，但 Porsche 实施了专有系统来读取和更改数据。只有经过培训(并购买了专用工具)的机械师才能维修车辆。

有趣的是，虽然使用专有诊断系统的制造商要求您在授权经销商处维修您的汽车，但一些有进取心的技术专家已经创建了兼容系统。以保时捷为例，Durametric ( [`www.durametric.com/default.aspx`](http://www.durametric.com/default.aspx) )制造了一系列产品，这些产品能够实现基本的维护功能，如故障和维修提醒重置，甚至为许多保时捷车型提供高级故障排除功能。图 [1-1](#Fig1) 显示了从保时捷 Cayman 上读取传感器数据的 Durametric 软件的一个屏幕。

![../images/313992_2_En_1_Chapter/313992_2_En_1_Fig1_HTML.jpg](../images/313992_2_En_1_Chapter/313992_2_En_1_Fig1_HTML.jpg)

图 1-1

来自 Durametric 的保时捷诊断数据

请注意显示的详细程度。该图显示了跟踪中的三个指标，但是如果您看屏幕的顶部，您会看到更多可以监控的指标。图表中显示的数据是通过保时捷采用的复杂传感器网络实时收集和显示的。

传感器在汽车中的应用已经开始扩展到相关的机械，如摩托车、船，甚至古老的农用拖拉机。许多现代农业机械(如联合收割机)都配有先进的传感器，可实现自动割台高度、自动驾驶等惊人功能。

例如，现代联合收割机可以与一套基于 GPS 的工具一起购买，这些工具允许操作员绘制收割区域的边界，并计算出最短时间和最大收获量的最佳路径。在收割田地非常大的情况下，操作员几乎可以在联合收割机工作时小睡片刻。 <sup>[3](#Fn3)</sup> 这与需要手动调节割台的老式联合收割机相去甚远。

#### 环境

环境是许多人关心的问题，许多科学家正在积极地监测它。监控环境的动机包括检查特定区域或房间的气体和跟踪该区域的温度和湿度，以及监控和报告敏感设备的异常情况，例如对洁净室进行化学分析。环境传感器网络的例子包括用于监测空气污染、探测和跟踪森林火灾、探测滑坡、提供地震预警以及提供工业和结构监测的网络。

传感器网络非常适合各种形式的环境监控。由于传感器尺寸小、能耗低、成本低，因此可以轻松安装在特定位置或特定机器上，以获得精确的报告。例如，洁净室环境通常需要非常精确的温度和湿度控制以及极低水平的污染物(漂浮在空气中的松散颗粒)。传感器可用于在关键位置(窗户、门、通风口等)测量这些观察结果；数据被发送到计算机，计算机记录数据并产生阈值警报。大多数复杂的洁净室将过滤、加热和冷却系统连接到同一个计算机系统中(使用它们自己的传感器)，以根据从传感器网络收集的数据来控制环境。

环境传感器不限于温度、湿度、露点和空气质量。用于监控电磁干扰和无线电频率的传感器可用于医院，以保护依赖敏感电子医疗设备(如心脏起搏器和类似的救生电子设备)的患者。 <sup>[4](#Fn4)</sup> 用于监测水纯度、氧气水平和污染物的传感器可用于养鱼场，以使作物产量最大化。

科学家和工业工程师不是唯一建立环境传感器网络的人。您可以使用成本相对较低的传感器构建自己的传感器。艾米丽·格茨和帕特里克·迪·高山重友在他们的书《Arduino 环境监测:构建简单的设备来收集我们周围世界的数据》中展示了如何构建简单的传感器网络来监测噪音、水的纯度，当然还有天气。

如果这听起来好得不像是真的，现在考虑一下你的普通家庭供暖、通风和制冷系统(HVAC)。它有一个非常简单的传感器网络，通常采用一个或多个环境温度传感器(墙上的恒温器)的形式，将数据输入到控制板，控制板打开机械装置，将气体泵送到系统中，并通过风扇移动空气。一些现代 HVACs 使用额外的传感器来监测空气质量，并使用额外的主动电子过滤器 <sup>[5](#Fn5)</sup> 或将热量和冷却转移到最需要的地方。如果你已经购买了一个现代的 Wi-Fi 恒温器，你可能会惊讶地发现它是一个物联网设备，因为大多数允许你从任何房间甚至当你不在家时控制你的 HVAC 系统。

Is a Thermostat a Sensor Node?

如果你曾经在一个有恒温器的家里使用滑动或旋转臂来设置所需的温度，很可能你遇到了一个简单的传感器节点。老式恒温器结合使用温度感应线圈和安装在线圈上的倾斜开关。这个线圈依次安装在一个板上，该板可以向一个方向或另一个方向倾斜，以调节所需的温度。随着室温的变化，线圈会膨胀或收缩，重新调整倾斜开关的方向。一旦线圈膨胀或收缩，倾斜开关断开，流向暖风、通风与空调装置的电压停止，从而关闭该装置。

一些制造商正在制造越来越复杂的恒温器。有些甚至能够记录数据和预测趋势。例如，Nest Learning 恒温器( [`www.nest.com/living-with-nest/`](http://www.nest.com/living-with-nest/) )可以检测何时有人在家，并可以通过互联网远程访问。

#### 大气的

与环境监测密切相关的是大气监测:一种旨在监测空气质量的传感器网络。大气监测是环境监测的一种形式，但更侧重于研究大气。显而易见的原因是，没有空气，哺乳动物根本无法生存(至少，不会长久)。

与环境传感器网络一样，有专门的传感器来测量所有形式的空气质量，包括游离气体、颗粒污染、烟雾、湿度等。建立大气传感器网络的其他动机包括测量工厂和汽车的污染(大多数汽车在发动机和机舱系统中集成了几个大气传感器)，确保来自水处理厂的清洁饮用水，以及测量气溶胶的影响。

幸运的是，对于业余爱好者和有抱负的大气科学家来说，气体传感器有很多，而且很多都不贵。更好的是，互联网上的许多示例项目演示了如何构建大气传感器网络。

Environment vs. Atmosphere: What’s The Difference?

如果你想知道环境和气氛之间的区别，你并不孤单。简单来说，环境是主体周围影响主体的事物(人、物、事)的集合体。因此，它可以是你周围的所有事物，包括环境温度、湿度等等。

大气(字面意思是空气)是指充满物体周围空间的气体集合。气氛是环境的要素之一。科学家已经定义了地球周围的许多层大气。大多数大气传感器设计用于测量特定水平的独特气体。我们居住的低层大气叫做对流层。

像前面讨论的环境监测传感器网络一样，您可以构建自己的大气传感器网络。在他们的书《使用 Arduino 进行大气监测:构建简单的设备来收集环境数据》中，艾米丽·格茨和帕特里克·迪·高山重友还展示了如何构建简单的传感器网络来测量气体，如丁烷和甲烷、光波长、臭氧等。

#### 安全

一些最流行和最多产的传感器网络是用于安全和监视的。您可能不认为安全系统是传感器网络，但让我们考虑一下典型的家庭或办公室安全系统包含哪些内容。

一个基本的安全系统被设计成在门或窗被打开时进行记录和报警。这种网络中的传感器是开关(所有传感器中最简单的一种),可以检测门或窗何时被打开或关闭。中央处理器或微控制器可用于监控传感器并采取行动:例如，用蜂鸣器或铃产生信号。

监控系统不仅仅包括一组开关。通常情况下，这种系统包括视频传感器(相机-具有或不具有红外功能，以增强夜间照片)、边界传感器(运动、视线中断等)。)，甚至还有音频传感器(麦克风)。该系统还可以包括某种形式的监视器，该监视器记录数据并使用户能够查看该数据(查看门何时被打开、听音频和看视频)。

大多数家庭监控系统包括数字录像机(DVR)或类似的专用系统以及一个或多个摄像机。一种流行的家庭系统包括四个带音频的摄像机。该系统允许您以编程方式记录来自传感器的数据，并实时查看视频。图 [1-2](#Fig2) 展示了一个来自 Harbor Freight ( [`www.harborfreight.com`](http://www.harborfreight.com) )的典型且经济实惠的家庭监控系统。

![../images/313992_2_En_1_Chapter/313992_2_En_1_Fig2_HTML.jpg](../images/313992_2_En_1_Chapter/313992_2_En_1_Fig2_HTML.jpg)

图 1-2

安全传感器网络:港口货运的家庭监控系统

企业中使用的监控系统类似于家庭监控系统，但通常包括额外的传感器和数据跟踪，如员工徽章、设备监控和集成，以及非现场支持服务，如守夜人和数据归档。

另一个例子包括在门铃、安全灯和类似的外部设备上增加摄像机。例如，一些最新的摄像头门铃有运动和类似的传感器来检测运动，甚至在晚上增强视频。有些，像门铃，允许两个或更多的门铃链接在一起，形成一个“邻里守望”系统( [`https://shop.ring.com/pages/neighbors`](https://shop.ring.com/pages/neighbors) )。最重要的是，它们提供实时警报，可以帮助您更快地发现犯罪并向当局报警。是的，这也是一个物联网设备！

尽管它们不像温度、湿度、光线或气体传感器那样便宜，但麦克风和摄像头正变得越来越便宜。你可以在电子商店找到这些传感器，比如 Adafruit 工业。例如，Adafruit 有一个摄像头( [`http://adafruit.com/products/397`](http://adafruit.com/products/397) )，你可以将其连接到你的 Arduino 或 Raspberry Pi 来记录图像和低帧率视频(见图 [1-3](#Fig3) )。

![../images/313992_2_En_1_Chapter/313992_2_En_1_Fig3_HTML.jpg](../images/313992_2_En_1_Chapter/313992_2_En_1_Fig3_HTML.jpg)

图 1-3

Adafruit Industries 的摄像头传感器(由 Adafruit 提供)

许多安全传感器网络可供消费者使用。它们从简单的音频/视频监控到集成到您家中的远程监控系统，可以跟踪从移动到门户漏洞，甚至温度和照明等一切。

### 传感器网络的拓扑结构

现在您已经看到了一些例子，让我们来讨论一下传感器网络的组件:在本例中，是一个花园池塘监控系统。具体来说，该系统监测鱼塘的健康状况。因此，该系统是一个环境传感器网络。

这样做的动机是为了确保鱼有一个安全的环境。这意味着水温应在鱼类的耐受范围内，水深应保持在适当的深度，以避免水位过高或过低，并且应监测水中的含氧量，以确保有足够的氧气供鱼类生存。类似地，可以使用传感器来确保诸如其他水生动物或藻类的共生生命的健康水平。

大多数池塘主人已经学会了用生命周期来建造池塘，以确保池塘能够维持其环境。然而，事情可能会出错。另一种物种的引入(如两栖动物 <sup>[6](#Fn6)</sup> 或可怕的藻类泛滥)会导致失衡，威胁到你珍贵的锦鲤。如果能够检测到不平衡何时开始，那么解决方案就更容易实施。

图 [1-4](#Fig4) 显示了描述传感器及其位置的简图。在这个系统中，有三个传感器，一个监控或记录系统，以及一个通信介质——传感器向监控器发送数据的一种方式。让我们从讨论传感器开始。

![../images/313992_2_En_1_Chapter/313992_2_En_1_Fig4_HTML.jpg](../images/313992_2_En_1_Chapter/313992_2_En_1_Fig4_HTML.jpg)

图 1-4

典型的鱼塘监控系统

如果我要建造这个系统，我会使用低压传感器，这样我就可以用电池或太阳能为它们供电。大多数传感器都是分立元件，接收电压并产生数字或模拟数据。它们需要另一个组件来读取数据并将其发送到池塘监控控制系统。如果你认为这将是一个 Arduino 的好用途，你是对的！Arduino 是从一个或多个传感器读取数据并将其发送到另一个系统进行处理的优秀平台。一些有事业心的 Arduino 爱好者仅使用一个 Arduino 和多个传感器构建了监控系统。

让我们假设池塘监控系统是一台连接了 Arduino 的计算机，这样您就可以远程记录、查看或访问数据。现在，您已经将传感器连接到一个 Arduino(称为传感器节点)，并将池塘监控系统连接到另一个 Arduino(称为聚合器节点)。缺少的是如何将数据从传感器节点传送到汇聚节点。

有许多方法可以让两个 Arduinos 进行通信或共享数据，但本书将讨论限制在允许长距离通信的媒体上——有线或无线。在这种情况下，有线通信可以通过以太网屏蔽(一种设计用于 Arduino 顶部的特殊子板)或安装在每个 Arduino 上的无线保真(Wi-Fi)屏蔽进行。

正如您所看到的，构建传感器网络涉及许多级别的硬件和协议。现在，您已经对主要组件有了大致的了解，让我们来研究一下通信介质，然后讨论一下传感器节点的类型。

## 传播介质

现在，您已经了解了传感器网络的拓扑结构，让我们考虑传感器如何将数据传递给网络中的其他节点。他们通过两种基本形式的网络通信来实现:有线和无线。

### 有线网络

有线网络可以采取多种形式，包括某种形式的硬件，用于通过电线或电缆将电信号从一个设备发送到另一个设备。因此，采用有线通信的传感器网络也必须向网络中的节点添加网络硬件。

正如我前面提到的，您可以使用带有以太网屏蔽的 Arduino 将传感器节点连接到聚合或数据收集节点。如果您的传感器由 Raspberry Pi 计算机托管，您就已经拥有了连接两台 Raspberry Pi 计算机的必要硬件——它们都有 RJ-45 局域网端口。

当然，使用有线以太网并不像将一根电缆插入两台设备那么简单。除非使用交叉电缆，否则需要某种形式的以太网交换机来连接设备。以太网网络和硬件的详细讨论超出了本书的范围，但它是传感器网络的一种可行的通信介质。

虽然由于许多 Wi-Fi 解决方案的可用性，有线网络的使用在今天没有那么流行，但使用有线网络有助于提高传输速度和可靠性，在某些情况下，还可以提高安全性。

### 无线网络

一种更受欢迎和更通用的媒体是无线通信。在这种情况下，您可以为每个 Arduino 使用无线设备，例如 Wi-Fi shield，或者为 Raspberry Pi 电脑使用 Wi-Fi 适配器。与有线以太网一样，无线以太网(Wi-Fi)需要添加无线路由器。但是，Wi-Fi 的最大距离要短得多，因此可能不适合某些网络。

但是你有另一种无线方式可以使用。您可以使用 XBee 无线模块来代替以太网(Wi-Fi)。XBee 提供了一种专门的轻量级协议，非常适合用于传感器节点、小型微控制器和嵌入式系统。甚至还有支持蓝牙 Mesh 的模块，但我们将把重点放在 Wi-Fi 模块上。本书的其余部分使用 XBee 模块作为示例传感器网络项目的通信机制。

XBee 模块的一个特性是它们是低功率的，并且可以被置于周期性睡眠模式以节省功率。然而，最好的特性是 XBee 模块可以直接连接到传感器，允许您构建更轻(更便宜)的传感器节点。XBee 模块将在第 [2](02.html) 章中详细讨论。

### 混合网络

一些复杂的传感器网络需要混合两种通信介质。例如，工业传感器网络可以使用安装在许多不同建筑物或房间中的传感器节点来收集数据。您可能希望将传感器网络隔离成子系统，因为每个区域可能需要不同形式的传感器网络。在这种情况下，对于难以使用有线网络的某些部分(例如移动的工业机器人上的传感器)，最好使用无线网络，并使用有线以太网将子系统连接到中央数据记录或数据监控系统。

## 传感器节点的类型

传感器节点由一个或多个传感器(虽然本书每个节点只使用一个传感器)和一个通信设备组成，用于传输数据。如上所述，通信设备可以是 Arduino 之类的微控制器、嵌入式系统，甚至是 Raspberry Pi 之类的小型计算机。典型地，传感器节点被设计用于无人值守的操作；它们有时安装在移动物体上或有线通信不切实际的地方。在这些情况下，传感器节点可以被设计成在不受电源或通信源限制的情况下工作。

从逻辑上讲，传感器节点可以根据其使用方式分为不同的类型。以下部分详细介绍了本书中使用的传感器节点类型。按角色考虑传感器节点有助于您使用逻辑构建块来设计和规划传感器网络。

### 基本传感器节点

在传感器网络的最低(或叶)层是基本传感器节点。这是迄今为止所描述的节点类型——它具有单个传感器和通信机制。这些节点不以任何方式存储或处理捕获的数据，它们只是将数据传递给网络中的另一个节点。

### 数据节点

下一种类型的节点是数据节点。数据节点是存储数据的传感器节点。这些节点可以将数据发送到另一个节点，但通常是将数据发送到数据卡等存储机制、通过计算机发送到数据库或直接发送到 LCD 屏幕、面板仪表或 LED 指示灯等视觉输出设备的设备。

数据节点需要的设备不仅仅是将数据传递给另一个节点。他们需要能够记录或展示数据。这是微控制器的一个很好的用途，你会在后面的章节中看到。XBee 的制造商 Digi 拥有专用的传感器节点，可以测量温度、湿度和光线信息，并在网络上传输数据。那有什么好玩的？在本书中，您将构建自己的传感器节点。

数据节点可用于形成自主或无人值守的传感器网络，记录数据供以后存档。回到鱼池的例子，许多商业池塘监控系统采用具有多个传感器的独立传感器设备，这些传感器将数据发送到数据节点；用户可以访问数据节点并在计算机上读取用于分析的数据。

### 聚合器节点

另一种类型的节点是聚合节点。这些节点通常使用通信设备和记录设备(或网关)而没有传感器。它们用于从一个或多个数据或传感器节点收集数据。在迄今为止讨论的示例中，监控系统将具有一个或多个聚集器节点来从传感器读取数据。图 [1-5](#Fig5) 显示了每种类型的节点将如何在一个虚构的传感器网络中使用。

![../images/313992_2_En_1_Chapter/313992_2_En_1_Fig5_HTML.jpg](../images/313992_2_En_1_Chapter/313992_2_En_1_Fig5_HTML.jpg)

图 1-5

传感器网络中的节点类型

对于更一般的情况，图表可能应该显示多个数据节点(以便聚合器节点聚合东西)。

在这个例子中，顶部的几个传感器节点向中间的一个数据节点无线发送数据。数据节点收集数据并将其保存到安全数字卡中，然后安全数字卡将数据发送到聚合器节点，聚合器节点通过有线计算机网络与数据库服务器通信以存储数据。将数据节点与聚合器节点混合使用，可以确保在聚合器节点出现故障或者记录和监控系统出现故障或离线时不会丢失任何数据。

现在您已经了解了传感器网络中的节点类型，让我们来看看传感器:它们如何测量数据，以及可用于构建低成本传感器网络的传感器示例。

## 传感器

谈到传感器、什么是传感器网络以及它们如何传递数据，您可能想知道传感器到底是什么，它们有什么意义。本节及其小节回答了这些问题以及更多问题。让我们从传感器的定义开始。

传感器是一种测量物理世界现象的装置。这些现象可以是你看到的东西，像光、气体、水蒸气等等。它们也可以是你感觉到的东西，像温度、电、水、风等等。人类的感觉就像传感器一样，让我们能够体验周围的世界。然而，有些东西你的传感器看不到或感觉不到，比如辐射、无线电波、电压和安培数。在测量这些现象时，传感器的工作是以电压表示或数字的形式传递测量结果。

传感器有多种形式。它们通常是为单一用途设计的低成本设备，处理能力有限。大多数简单的传感器都是分立元件；甚至那些具有更复杂部件的设备也可以被视为单独的组件。传感器可以是模拟的，也可以是数字的，通常只用于测量一种东西。但是越来越多的传感器模块被设计用来测量一系列相关现象，例如来自 SparkFunElectronics([`www.sparkfun.com/products/10586`](http://www.sparkfun.com/products/10586))的 USB 天气板(见图 [1-6](#Fig6) )。

![../images/313992_2_En_1_Chapter/313992_2_En_1_Fig6_HTML.jpg](../images/313992_2_En_1_Chapter/313992_2_En_1_Fig6_HTML.jpg)

图 1-6

USB 天气板(由 SparkFun 和胡安·佩尼亚提供)

注意上面写着 XBee 的蓝色模块。这是一个无线模块，允许传感器板将其数据发送到另一个或多个节点。XBee 将在第 [2](02.html) 章中详细讨论。

以下部分探讨传感器如何测量数据、如何存储数据，以及一些常见传感器的示例。

### 传感器如何测量

传感器是基于其化学和机械结构的独特属性产生电压的电子设备。他们不能操纵他们被设计用来测量的现象。相反，传感器对一些物理变量进行采样，并将其转换为成比例的电信号(电压、电流、数字信号等)。

例如，湿度传感器测量空气中水(湿气)的浓度。湿度传感器对这些现象做出反应，并产生一个电压，微控制器或类似设备可以读取该电压，并使用该电压来计算秤的数值。一种基本的低成本湿度传感器是 DHT-22，可从大多数电子商店买到(见图 [1-7](#Fig7) )。

![../images/313992_2_En_1_Chapter/313992_2_En_1_Fig7_HTML.jpg](../images/313992_2_En_1_Chapter/313992_2_En_1_Fig7_HTML.jpg)

图 1-7

DHT-22 湿度传感器(由 Adafruit 提供)

DHT-22 设计用于测量温度和湿度。它在输出端(数据引脚)产生一个数字信号。虽然使用简单，但它有点慢，应该用于以合理的慢速度跟踪数据(不超过每 3 或 4 秒一次)。

当该传感器产生数据时，数据以一系列高(解释为 1)和低(解释为 0)电压的形式传输，微控制器可以读取并使用这些电压来形成一个值。在这种情况下，微控制器从传感器读取长度为 40 位(40 个高或低电压脉冲)的值，即 5 个字节，并将其放入程序变量中。前两个字节是湿度值，后两个字节是温度值，第五个字节是校验和值，以确保读数准确。幸运的是，所有这些艰苦的工作都以专门为 DHT-22 和类似传感器设计的库的形式为您完成了。让我们看看这在实践中是如何工作的。

清单 [1-1](#PC1) 展示了 Adafruit 为 Arduino 平台提供的 DHT 库的摘录。你可以在 [`https://github.com/adafruit/DHT-sensor-library`](https://github.com/adafruit/DHT-sensor-library) 找到这个库。该列表显示了用于从 Arduino 上的 DHT-22 传感器库中读取湿度的方法。

```
/*
  Beginning Sensor Networks, 2nd Edition

  This sketch demonstrates a basic sensor node using a DHT22 sensor to read temperature and humidity printing the results
  in the serial monitor.

  Dr. Charles Bell
*/
#include <DHT.h>
#include <DHT_U.h>

#define DHTPIN 2        // Digital pin connected to the DHT sensor
#define DHTTYPE DHT22   // DHT 22  (AM2302), AM2321

DHT dht(DHTPIN, DHTTYPE);

void setup() {
}

void loop() {
  float humidity = dht.readHumidity();
  float temperature = dht.readTemperature();

  // Make sure they are numbers or fail.
  if (isnan(temperature) || isnan(humidity)) {
    Serial.println("ERROR: DHT values are not numbers!");
  } else {
    Serial.print("Temperature (C): ");
    Serial.print(temperature);
    Serial.print("Humidity: ");
    Serial.print(humidity);
  }
}

Listing 1-1Reading Temperature and Humidity with a DHT-22

```

请注意，DHT 库提供了使读取温度(摄氏度)和湿度并显示这些值变得非常容易的方法。 <sup>[7](#Fn7)</sup> 没错，就是这么简单！如果你想尝试 DHT-22，在 Adafruit 的网站上有一个很好的教程( [`http://learn.adafruit.com/dht`](http://learn.adafruit.com/dht) )。

回想一下，DHT-22 产生一个数字值。不是所有的传感器都这样做；一些产生电压范围。这些被称为模拟传感器。让我们花一点时间来理解它们的区别。这将成为您规划和构建传感器节点的重要信息。

#### 模拟传感器

模拟传感器是产生电压范围的装置，通常在 0 到 5 伏之间。 <sup>[8](#Fn8)</sup> 需要一个模数转换电路将电压转换成数字。大多数微控制器都内置了这一功能，Arduino 就是一个很好的例子。Arduino 有一组有限的引脚，用于处理模拟数据，并集成了模数(A/D)转换电路。

但事情并没有那么简单(是吗？).模拟传感器的工作原理类似于电阻，当连接到微控制器时，通常需要另一个电阻来“上拉”或“下拉”电压，以避免称为浮动的虚假电压变化。这是因为流过电阻的电压在时间和幅度上都是连续的。因此，即使传感器不产生值或测量值，仍有电压流过传感器，可能导致虚假读数。您的项目需要明确区分关(零电压)和开(正电压)。上拉和下拉电阻确保您拥有这两种状态之一。模数转换器负责从传感器读取电压，并将其转换为可被解读为数据的值。

What is a Resistor?

电阻器是电子学的标准构件之一。它的作用是阻止电流并降低电压(转化为热量)。它的影响被称为电阻，用欧姆来衡量。电阻可用于降低其它元件的电压，限制频率响应，或保护敏感元件免受过压影响。

当电阻用于上拉电压(通过将一端连接到正电压)或下拉电压(通过将一端连接到地)(电阻是双向的)时，它消除了电压在不确定状态下浮动的可能性。因此，上拉电阻确保稳定状态为正电压，下拉电阻确保稳定状态为零电压(地)。

一本优秀的入门电子书籍是查尔斯·普拉特(O'Reilly，2012)的《电子元件百科全书》。

采样时(从传感器读取值时)，电压读数必须解释为给定传感器指定范围内的值。请记住，比方说，一个模拟传感器输出的 2 伏电压可能与另一个模拟传感器输出的 2 伏电压不是一回事。每个传感器的数据表显示了如何解释这些值。

当您使用 Arduino 之类的微控制器时，模数转换器可以方便地将电压转换为 10 位值，从而得到 0 到 1023 之间的整数值。例如，一个传感器可以测量由 200 个点组成的范围内的现象。最低值通常表示 0，最高值表示 1023。在这种情况下，可以对 Arduino 进行编程，将从 A/D 转换器读取的值转换为传感器刻度上的值。

如您所见，使用模拟传感器比使用上一节中的 DHT-22 数字传感器要复杂得多。稍加练习，您会发现，一旦了解如何将模拟传感器连接到微控制器，以及如何在传感器校准工作的范围内解释其电压，大多数模拟传感器都不难使用。

#### 数字传感器

像 DHT-22 这样的数字传感器被设计成使用串行传输产生一串比特(一次一个比特)。然而，一些数字传感器通过并行传输产生数据(一次一个或多个字节 <sup>[9](#Fn9)</sup> )。如前所述，这些位表示为电压，其中高电压(比如 5 伏)或开是 1，低电压(0 甚至-5 伏)或关是 0。这些开和关值序列称为离散值，因为传感器以脉冲形式产生一个或另一个值，即开或关。

与模拟信号相比，数字传感器的采样频率更高，因为它们生成数据的速度更快，而且不需要额外的电路来读取数值(例如 A/D 转换器以及将数值转换为刻度的逻辑或软件)。因此，数字传感器通常比模拟传感器更精确和可靠。但是，数字传感器的精度与其用于采样数据的位数成正比。

数字传感器最常见的形式是按钮或开关。什么，按钮是传感器？为什么，是的，它是一个传感器。考虑一下安装在家庭安全系统窗户上的传感器。这是一个简单的开关，当窗户关闭时关闭，当窗户打开时打开。当开关连接到电路中时，当车窗关闭且开关闭合时，电流是恒定且不间断的(使用上拉电阻测量正电压)，但当车窗和开关打开时，电流中断(测量零电压)。这是最基本的开关传感器。

大多数数字传感器都是由几个元件组成的小电路，用于产生数字数据。与模拟传感器不同，读取它们的数据很容易，因为这些值无需转换就可以直接使用(除了转换到其他刻度或测量单位)。有些人可能认为这比使用模拟传感器更困难，但这取决于你的观点。电子爱好者会认为使用模拟传感器更容易，而程序员会认为数字传感器更容易使用。

那么，一旦数据被测量出来，你会怎么处理呢？以下部分简要描述了传感器数据的一些方面以及存储这些数据的注意事项。

### 存储传感器数据

存储传感器数据取决于如何解释数据以及最终如何使用数据。如果你计划使用计算机，或者更好的是数据库来存储数据，你应该以一种有意义的方式来存储它。

例如，存储模拟信号的电压序列可能被认为是以最纯粹的形式保存数据，但如果没有上下文或模数转换器，数据可能毫无意义。存储电压的数字转换可能也不明智，因为您必须记住刻度和范围，以获得想要表示的值。因此，存储结果转换成比例更有意义。幸运的是，当您使用数字传感器时，您唯一需要记住的是所使用的测量单位(摄氏度、华氏度、英尺、米等等)。因此，最好保存测量的最终形式。

但是你把这些信息存储在哪里呢？商业传感器网络将数据存储在嵌入式数据库或文件存储设备中，将其传输到另一个系统进行存储，或者将其存储在可移动数字介质上。较老的传感器网络(如测谎仪或 EKG 机器)使用图表将数据存储为硬拷贝(使它们非常过时)。

有几种简单的存储设备和技术可以用来构建自己的传感器网络，从 Arduino 的本地设备到 Raspberry Pi 上的现代硬盘。这里列出了这些存储机制，并在本书研究构建传感器网络时使用的硬件类型和技术应用时进行了更详细的讨论:

*   硬拷贝打印机

*   安全数字卡

*   USB 硬盘

*   网络服务器

*   数据库服务器(MySQL)

现在，让我们看看一些可用的传感器及其测量的现象类型。

### 传感器的例子

所有传感器网络都始于一个传感器和一种读取和解释数据的方法。本章介绍了许多关于传感器的信息。你可能在想各种各样有用的东西，你可以在家里或办公室，甚至在你的院子里或周围测量。你可能想测量你的新阳光房的温度变化，检测邮递员什么时候把最新的通知扔进你的邮箱，或者记录你的狗使用狗门的次数。我希望到现在为止，当你想象你能测量什么的时候，你能看到这些只是冰山一角。你应该在思考你想要建立一个什么样的传感器网络；你可以用这本书来学习如何建造它。

有哪些类型的传感器可用？下表描述了一些比较流行的传感器及其测量内容。这只是可用资源的一个样本。细读 Mouser Electronics ( [`www.mouser.com`](http://www.mouser.com) )、spark fun Electronics([`www.sparkfun.com`](http://www.sparkfun.com))和 Adafruit Industries ( [`http://adafruit.com/`](http://adafruit.com/) )等在线电子产品供应商的目录，会发现更多的例子:

*   *加速度计*:这些传感器测量传感器或它所连接的任何东西的运动或移动。它们被设计用来感知几个轴上的运动(速度、倾斜度、振动等)。).一些包括回转仪特征。大多数是数字传感器。Wii 双截棍(或 WiiChuck)包含一个复杂的加速度计，用于跟踪运动。啊哈:现在你知道 Wii 附带的那些有趣的小东西的秘密了。

*   *音频传感器*:也许这是显而易见的，但是麦克风是用来测量声音的。大多数是模拟的，但一些更好的安全和监控传感器具有数字版本，用于传输数据的更高压缩。

*   *条形码读取器*:这些传感器用于读取条形码。最常见的是，条形码阅读器生成代表条形码的数字等价物的数字数据。这种传感器通常用在库存跟踪系统中，以在工厂或运输过程中跟踪设备。它们数量众多，而且许多价格经济实惠，使您能够将它们整合到自己的项目中。

*   *RFID 传感器*:射频识别使用无源设备(有时称为 RFID 标签)通过电磁感应使用射频进行数据通信。例如，RFID 标签可以是信用卡大小的塑料卡、标签或类似的包含特殊天线的东西，通常以线圈、细线或箔层的形式调谐到特定频率。当标签被放置在阅读器附近时，阅读器发射无线电信号；标签可以使用电磁能量以无线电信号的形式传输嵌入在天线中的非易失性消息，该无线电信号然后被转换成字母数字串。 <sup>[10](#Fn10)</sup>

*   *生物传感器*:读取指纹、虹膜或掌纹的传感器包含一个用于识别模式的特殊传感器。鉴于指纹和掌纹等图案的独特性，它们是安全访问系统的优秀组件。大多数生物传感器产生一组代表指纹或掌纹的数字数据。

*   *电容传感器*:电容传感器的一种特殊应用，脉搏传感器被设计用来测量你的脉搏率，通常使用指尖作为传感部位。称为脉搏血氧仪(一些医疗专业人员称为 pulseox)的特殊设备通过电容传感器测量脉搏率，并通过光传感器确定血液中的含氧量。如果你拥有现代电子设备，你可能会遇到*触敏*按钮，它们使用特殊的电容传感器来检测触摸和压力。一些更新的版本可以用来测量液位。

*   硬币传感器:这是一种最不寻常的传感器。这些设备就像典型的自动售货机上的投币口。像它们的商业等价物一样，它们可以被校准以感应何时插入一定大小的硬币。虽然不像商业单位那样复杂，可以区分真假硬币，硬币传感器可以用来为您的项目添加一个新的维度。想象一个投币 Wi-Fi 站。现在，这应该可以防止孩子们在互联网上花太多时间！

*   *电流传感器*:用于测量电压和电流强度。有些是为测量变化而设计的，而有些是为了测量负载。

*   *挠曲/力传感器*:电阻传感器测量一块材料的挠曲或压力对传感器的影响。弯曲传感器可能有助于测量扭转效应或测量手指运动(就像任天堂的电动手套一样)。当传感器弯曲时，传感器电阻增加。

*   *气体传感器*:气体传感器种类繁多。有些测量潜在有害气体，如液化石油气和甲烷以及其他气体，如氢气、氧气等。其他气体传感器与光传感器相结合来感测空气中的烟雾或污染物。下次当你从烟雾探测器中听到那种泄露秘密且经常令人讨厌的低电量警告声 <sup>[12](#Fn12)</sup> 时，想想那个设备包含了什么。为什么，这是一个传感器节点！

*   *光传感器*:测量光线强弱的传感器是特殊类型的电阻:光敏电阻(LDRs)，有时也称为光敏电阻或光电池。因此，它们本质上是相似的。如果你有一台 Mac 笔记本电脑，当你的发光键盘在弱光下自动打开时，你很可能已经看到了光敏电阻的作用。或者，您的手机可以使用光传感器来改变亮度。特殊形式的光传感器可以检测其他光谱，如红外线(如旧的电视遥控器)。

*   *液体流量传感器*:这些传感器类似于阀门，内嵌在管道系统中。他们测量液体通过时的流量。基本的流量传感器使用旋转轮和磁铁来产生霍尔效应(快速开/关序列，其频率等于通过的水量)。

*   *液位传感器*:一种特殊的电阻固态装置可以用来测量水体的相对高度。一个例子是当水位高时产生低电阻，当水位低时产生高电阻。

*   *位置传感器*:现代智能手机有 GPS 传感器来感应位置，当然 GPS 设备也使用 GPS 技术来帮助你导航。幸运的是，GPS 传感器以低成本的形式提供，使您能够将位置检测添加到您的传感器网络中。GPS 传感器以经度和纬度的形式生成数字数据，但有些传感器也可以感知海拔高度。

*   *磁条阅读器*:这些传感器从磁条(像信用卡上的磁条)读取数据，并返回数字形式的字母数字数据(实际的字符串)。

*   *磁力计*:这些传感器通过磁场强度测量方位。指南针是一种用来寻找磁北的传感器。一些磁力计提供多个轴，以便更好地检测磁场。

*   *近程传感器*:近程传感器通常被认为是距离传感器，它使用红外线或声波来检测物体的距离或范围。受低成本机器人套件的欢迎，视差超声波传感器通过感应发送脉冲和接收脉冲之间的时间量(回声)，使用声波来测量距离。对于近似的距离测量， <sup>[13](#Fn13)</sup> 把时间转换成距离是一个简单的数学问题。这有多酷？

*   辐射传感器:比较严重的传感器是那些检测辐射的传感器。这也可能是电磁辐射(也有传感器)，但盖革计数器使用辐射传感器来检测有害的电离。事实上，使用一个传感器和一个 Arduino(以及一些电子元件)来建造你自己的盖革计数器是可能的。

*   *速度传感器*:像流量传感器一样，许多自行车上的简单速度传感器使用磁铁和簧片开关来产生霍尔效应。频率结合车轮的周长可以用来计算速度，以及随着时间的推移，行驶的距离。是的，自行车计算机是简单传感器网络的另一个例子:车轮和前叉上的速度传感器为车把上的监视器提供数据。

*   *开关和按钮*:这些是最基本的数字传感器，用于检测某个东西是否被设置(开)或重置(关)。

*   *倾斜开关*:这些传感器可以检测设备何时向某个方向倾斜。虽然非常简单，但它们对于低成本运动检测传感器非常有用。它们是数字的，本质上是开关。

*   *触摸传感器*:形成小键盘、键盘、定点设备等的触敏薄膜是一种有趣的传感器形式。你可以将像这样的触摸感应设备用于需要从人类身上收集数据的传感器网络。

*   *视频传感器*:如前所述，有可能获得非常小的视频传感器，这些传感器使用相机和电路来捕捉图像并将其作为数字数据传输。

*   *气象传感器*:温度、气压、降雨量、湿度、风速等传感器都属于气象传感器。大多数生成数字数据，可以组合起来创建全面的环境传感器网络。是的，通过十几个廉价的传感器、一个 Arduino(或一个 Raspberry Pi)和一些解释和组合数据的程序，你可以建立自己的气象站。

## 摘要

传感器无处不在。它们在你的办公室、车里、家里和我们的个人电子设备中(对大多数人来说，这意味着我们身边总是有一个传感器)。你遇到的大多数传感器都是分立的，比如烟雾探测器或恒温器。有时它们是一个更大的传感器集合的一部分，旨在实现某些功能，例如当你设置巡航控制时，你车上的传感器可以保持你的速度恒定，下雨时启动挡风玻璃雨刷，或者当你转向太靠近车道分界线时振动你的座位。

现在，您已经了解了更多关于传感器类型及其通信数据的信息，您可能已经开始考虑构建一些很酷的项目了。这本书将帮助你了解那些项目。本章研究了什么是传感器网络，它们是如何构建的，它们是如何通信的，以及传感器是如何工作的。您甚至看到了一些代码！

下一章通过深入到新 XBee 3 无线模块的一个简短教程来关注本书中使用的通信媒介。您将了解如何设置和配置这些设备，以便将传感器数据传输到数据和聚合节点。

<aside aria-label="Footnotes" class="FootnoteSection" epub:type="footnotes">Footnotes [1](#Fn1_source)

有趣的是，我听说过一些驾驶者轻视这些功能，因为他们的驾驶习惯将车辆更多地放在道路的一侧或另一侧，这触发了车道偏离警告。同样，那些在弯曲道路上驾驶时习惯性越过中心线的人往往会关闭偏离警告。显然，其中一个是可以理解的烦恼，而另一个正是为什么需要这个特性。

  [2](#Fn2_source)

[T2`http://en.wikipedia.org/wiki/On-board_diagnostics`](http://en.wikipedia.org/wiki/On-board_diagnostics)

  [3](#Fn3_source)

可能很难想象一台 46，000 多磅的机器由计算机驱动，它类似于中世纪的刑具或连环杀手的武器，但这是真的。一些最昂贵的联合收割机拥有比你最喜欢的运动轿车更复杂的技术，包括空调、巡航控制和完全可调的座椅。

  [4](#Fn4_source)

如果你的家庭成员需要这样的设备，这将变得非常重要。

  [5](#Fn5_source)

对于我们这些生活在自然和人为污染物高浓度地区的过敏症患者来说，电子过滤器是绝对必要的。

  [6](#Fn6_source)

我建造的每个池塘最终都让青蛙看似自然地诞生了。他们都来自哪里？

  [7](#Fn7_source)

使用 Arduino IDE 的串行监视器功能。有关如何使用串行监视器的详细信息，请参见第 [3](03.html) 章。

  [8](#Fn8_source)

也有输出为 4–20mA 的传感器，但在本书中，我们将重点介绍输出(信号)在 0–5V 范围内的传感器。

  [9](#Fn9_source)

这取决于并行缓冲区的宽度。8 位缓冲区一次可以传输 1 个字节，16 位缓冲区一次可以传输 2 个字节，依此类推。

  [10](#Fn10_source)

[T2`http://en.wikipedia.org/wiki/Radio-frequency_identification`](http://en.wikipedia.org/wiki/Radio-frequency_identification)

  [11](#Fn11_source)

[T2`www.sparkfun.com/products/11719`](http://www.sparkfun.com/products/11719)

  [12](#Fn12_source)

这里有一个很好的房主提示。不要跑来跑去试图找出哪个探测器间歇性地发出电池没电的信号(或误报)，考虑用有 10 年电池的新版本代替它们( [`www.lowes.com/pd/First-Alert-Micro-Photoelectric-Smoke-Alarm-with-10-Year-Battery/1000456457`](http://www.lowes.com/pd/First-Alert-Micro-Photoelectric-Smoke-Alarm-with-10-Year-Battery/1000456457) )。

  [13](#Fn13_source)

精度可能取决于环境变量，如海拔、温度等。

 </aside>